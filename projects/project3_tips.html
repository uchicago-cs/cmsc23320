
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Project 3 Tips &#8212; CMSC 23320 - Foundations of Computer Networks</title>

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/chiweb.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Project 3 Rubric" href="project3_rubric.html" />
    <link rel="prev" title="Project 3: chirouter" href="project3.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          CMSC 23320 - Foundations of Computer Networks</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              
              
            
            
            
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Course Information <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="../syllabus.html">Syllabus</a></li>
        <li><a href="../grading.html">Grading</a></li>
        <li><a href="../calendar.html">Calendar</a></li>
        <li><a href="../academic-honesty.html">Academic Honesty</a></li>
        <li><a href="../code-of-conduct.html">Code of Conduct for Course Staff</a></li>
    </ul>
</li>
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Projects <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="started.html">Getting Started</a></li>
        <li><a href="registering_submitting.html">Registering/Submitting</a></li>
        <li><a href="project1.html">Project 1: chirc</a></li>
        <li><a href="project2.html">Project 2: chiTCP</a></li>
        <li><a href="project3.html">Project 3: chirouter</a></li>
    </ul>
</li>
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Resources <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="https://uchicago-cs.github.io/student-resource-guide/" target="_blank">UChicago CS Student Resource Guide <i class="fa fa-external-link"></i></a></li>
        <li><a href="https://github.com/uchicago-cs/cmsc23320/tree/master/samples" target="_blank">Code Samples <i class="fa fa-external-link"></i></a></li>
        <li><a href="../resources/questions.html">Asking Questions</a></li>
        <li><a href="https://uchicago-cs.github.io/debugging-guide" target="_blank">The Debugging Guide <i class="fa fa-external-link"></i></a></li>
        <li><a href="../resources/other.html">Other Resources</a></li>
    </ul>
</li>

            
          </ul>

          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="project-3-tips">
<h1>Project 3 Tips<a class="headerlink" href="#project-3-tips" title="Permalink to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Project 3 has not yet been updated for Autumn 2022. You are welcome to read
through the project documentation, but bear in mind that some aspects of the
project may change. Please do not start working on the project until instructed
to do so in class.</p>
</div>
<p>Before you get started, make sure you’ve read through the <a class="reference external" href="../projects/started.html">Projects - Getting Started</a> page.</p>
<div class="section" id="using-the-cs-virtual-machine">
<h2>Using the CS Virtual Machine<a class="headerlink" href="#using-the-cs-virtual-machine" title="Permalink to this heading">¶</a></h2>
<p>The mininet network simulator in Project 3 must be run with root privileges
on a Linux machine. If you do not have access to such a machine, we recommend
using the <a class="reference external" href="https://howto.cs.uchicago.edu/vm:index">CS Virtual Machine</a> (version 202122.2 or higher)
to run mininet.  This virtual machine will only work on computers with Intel processors so, if you are running
a newer Mac with an M1 processor, please see our Ed Discussion site for instructions
on how to set up a virtual machine on your computer.</p>
<p>Take into account that this doesn’t mean you have to do all your development work inside the virtual machine; you
will be able to continue to use your usual development environment (your laptop,
a CSIL machine, etc.). You will simply need to follow the instructions on
“Running chirouter and mininet on separate machines” in the chirouter documentation. Please note that,
when using the CS Virtual Machine, the <code class="docutils literal notranslate"><span class="pre">HOST</span></code> you must specify in the <code class="docutils literal notranslate"><span class="pre">--chirouter</span></code> parameter
to <code class="docutils literal notranslate"><span class="pre">run-mininet</span></code> is <strong>10.0.2.2</strong>. This is the IP that, from inside the VM, will allow you to connect
to the host that is running the VM.</p>
<p>Please note that, for this to work, the Network settings for your VM (in VirtualBox) must indicate that
“Adapter 1” is attached to <strong>NAT</strong>. This is the default value but, if you change this value, it will likely prevent chirouter and mininet
from being able to communicate.</p>
</div>
<div class="section" id="resetting-mininet">
<h2>Resetting Mininet<a class="headerlink" href="#resetting-mininet" title="Permalink to this heading">¶</a></h2>
<p>If, at any point, Mininet starts behaving in an unexpected manner, specially if you see the following error message
when running chirouter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CRITIC</span> <span class="n">Error</span> <span class="k">while</span> <span class="n">processing</span> <span class="n">POX</span> <span class="n">message</span><span class="o">.</span>
<span class="n">CRITIC</span> <span class="n">Error</span> <span class="k">while</span> <span class="n">receiving</span> <span class="n">messages</span> <span class="kn">from</span> <span class="nn">POX</span>
</pre></div>
</div>
<p>Try stopping chirouter and mininet, and then running this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mn</span> <span class="o">-</span><span class="n">c</span>
</pre></div>
</div>
<p>This will reset Mininet to a clean configuration. Next, try re-running the chirouter and mininet commands as usual.</p>
</div>
<div class="section" id="unexpected-udp-packets-on-port-67">
<h2>Unexpected UDP packets on port 67<a class="headerlink" href="#unexpected-udp-packets-on-port-67" title="Permalink to this heading">¶</a></h2>
<p>If you are running Mininet on your own machine (as opposed to inside a VM), certain traffic from your machine can leak
into Mininet. Most notably, a Linux machine running Network Manager (as most Ubuntu distros do) will probably try to
send DHCP requests (on UDP port 67) to the network interfaces created by Mininet, and these will show up in your logs.
You can safely ignore them, but you may want to consider using our provided VM, which will provide a more controlled
environment on which to run Mininet.</p>
</div>
<div class="section" id="always-create-protocol-headers-from-scratch">
<h2>Always create protocol headers from scratch<a class="headerlink" href="#always-create-protocol-headers-from-scratch" title="Permalink to this heading">¶</a></h2>
<p>Whenever you are creating a protocol header, it is good practice to create it from scratch, instead of trying to reuse
an existing header. For example, suppose you receive an IP datagram that will cause an ICMP reply to be sent. You may
be tempted to take the IP header, make any necessary modifications in-place, and create a new payload. This is very
error-prone, specially if you do this at various points in your code. It is better to have a separate function
that will create a new protocol header, forcing you to think about the exact values you need to provide
in every field of the header, than to try to reuse existing headers.</p>
<p>Note: this does not apply to IP forwarding, where the existing IP header is kept largely intact, except for some
well-defined modifications.</p>
</div>
<div class="section" id="using-wireshark-to-analyze-the-capture-files">
<h2>Using Wireshark to analyze the capture files<a class="headerlink" href="#using-wireshark-to-analyze-the-capture-files" title="Permalink to this heading">¶</a></h2>
<p>Every time you test your router, you should generate a capture file (using the <code class="docutils literal notranslate"><span class="pre">-c</span></code> option to chirouter,
not by doing a live capture) and then open it with Wireshark. If there are any issues in the Ethernet/IP/ICMP/ARP messages you are
generating, Wireshark will likely highlight them for you, which will make it easier to catch these
kind of issues.</p>
<p>Take into account that, by far, the most common issue is incorrectly computing a checksum somewhere.
This issue is particularly hard to catch because, if you include an incorrect checksum somewhere,
your message will be silently dropped by tools like ping, traceroute, etc. In other words, you may
be doing every other step correctly (like forwarding an IP datagram through the correct interface)
only to have your datagram silently rejected when it arrives at its destination.</p>
<p>However, take into account that IPv4 checksum validation is disabled by default in Wireshark.
You can enable it like this:</p>
<img alt="../_images/wireshark_checksum.png" class="align-center" src="../_images/wireshark_checksum.png" />
</div>
<div class="section" id="asking-questions">
<h2>Asking questions<a class="headerlink" href="#asking-questions" title="Permalink to this heading">¶</a></h2>
<p>Related to the above, if you need help with your code, please make sure to include
a capture file in your question. While including relevant logs will also be helpful,
a capture file will be much more useful in helping us diagnose the issue with your code.</p>
</div>
<div class="section" id="common-pitfalls">
<h2>Common Pitfalls<a class="headerlink" href="#common-pitfalls" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p><strong>Computing a checksum over a pointer instead of what the pointer points to</strong>: Suppose you have the following variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">iphdr_t</span> <span class="o">*</span><span class="n">hdr</span><span class="p">;</span>
</pre></div>
</div>
<p>And that you have malloc’d and populated the values in the IP header. A common mistake is to call the <code class="docutils literal notranslate"><span class="pre">cksum</span></code> function like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cksum</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">hdr</span><span class="p">))</span>
</pre></div>
</div>
<p>This will compute a checksum over 8 bytes, because <code class="docutils literal notranslate"><span class="pre">hdr</span></code> is a pointer, and its size is 8 bytes. Make sure you pass the correct size to <code class="docutils literal notranslate"><span class="pre">cksum</span></code>. For an IP header, you would call <code class="docutils literal notranslate"><span class="pre">cksum</span></code> like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cksum</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">iphdr_t</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p><strong>Computing ICMP header sizes</strong>: Related to the above, you cannot use <code class="docutils literal notranslate"><span class="pre">sizeof(icmp_packet_t)</span></code>, since <code class="docutils literal notranslate"><span class="pre">icmp_packet_t</span></code> is a <code class="docutils literal notranslate"><span class="pre">union</span></code> type,
and will likely yield an incorrect size. You should manually compute the size of your ICMP packet.</p></li>
<li><p><strong>Forgetting to use htons, htonl, etc.</strong>: Remember that the values in the protocol headers have to be in <em>network order</em>, and
you must use functions like htons and htonl to convert from host order to network order (and ntohs and ntohl to convert from
network order to host order)</p></li>
<li><p><strong>… except with checksums</strong>: The <code class="docutils literal notranslate"><span class="pre">cksum</span></code> function already produces a checksum in network order. There is no need to convert it from host order to network order.</p></li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011-2022, The University of Chicago.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>