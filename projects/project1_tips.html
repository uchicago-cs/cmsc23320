
<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Project 1 Tips &#8212; CMSC 23320 - Foundations of Computer Networks</title>

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=0bf093e7" />
    <link rel="stylesheet" type="text/css" href="../_static/chiweb.css?v=4e80c602" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Project 1 Rubric" href="project1_rubric.html" />
    <link rel="prev" title="Project 1: chirc" href="project1.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          CMSC 23320 - Foundations of Computer Networks</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              
              
            
            
            
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Course Information <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="../syllabus.html">Syllabus</a></li>
        <li><a href="../calendar.html">Calendar</a></li>
        <li><a href="../getting-help.html">Getting Help</a></li>
        <li><a href="../academic-integrity.html">Academic Integrity</a></li>
        <li><a href="../code-of-conduct.html">Code of Conduct for Course Staff</a></li>
    </ul>
</li>
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Projects <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="started.html">Getting Started</a></li>
        <li><a href="project1.html">Project 1: chirc</a></li>
        <li><a href="project2.html">Project 2: chiTCP</a></li>
        <li><a href="project3.html">Project 3: chirouter</a></li>
    </ul>
</li>
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Resources <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="https://uchicago-cs.github.io/student-resource-guide/" target="_blank">UChicago CS Student Resource Guide <i class="fa fa-external-link"></i></a></li>
        <li><a href="https://github.com/uchicago-cs/cmsc23320/tree/master/samples" target="_blank">Code Samples <i class="fa fa-external-link"></i></a></li>
        <li><a href="https://uchicago-cs.github.io/debugging-guide" target="_blank">The Debugging Guide <i class="fa fa-external-link"></i></a></li>
        <li><a href="../resources/other.html">Other Resources</a></li>
    </ul>
</li>

            
          </ul>

          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Project 1 Tips</a><ul>
<li><a class="reference internal" href="#before-you-get-started">Before you get started</a></li>
<li><a class="reference internal" href="#project-1-warm-up">Project 1 Warm-up</a></li>
<li><a class="reference internal" href="#resolving-irc-ambiguities">Resolving IRC Ambiguities</a></li>
<li><a class="reference internal" href="#common-issues-in-chirc-assignment-1">Common Issues in chirc Assignment 1</a><ul>
<li><a class="reference internal" href="#error-handling-in-sockets">Error handling in sockets</a></li>
<li><a class="reference internal" href="#general-socket-confusion">General socket confusion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-issues-in-chirc-assignment-4">Common Issues in chirc Assignment 4</a><ul>
<li><a class="reference internal" href="#inadequate-locking">Inadequate locking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-c-issues">Common C Issues</a><ul>
<li><a class="reference internal" href="#bad-memory-management">Bad memory management</a></li>
<li><a class="reference internal" href="#arbitrary-sizes">Arbitrary sizes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <section id="project-1-tips">
<h1>Project 1 Tips<a class="headerlink" href="#project-1-tips" title="Link to this heading">¶</a></h1>
<section id="before-you-get-started">
<h2>Before you get started<a class="headerlink" href="#before-you-get-started" title="Link to this heading">¶</a></h2>
<p>When writing the socket code for your chirc server, make sure you take a look at the
<a class="reference external" href="https://github.com/uchicago-cs/cmsc23320/tree/master/samples/sockets">socket samples</a> covered
in the lecture on socket programming. They can provide a good starting point for writing a multi-threaded
server (note: you won’t have to write a multi-threaded server for Assignment 1 of chirc)</p>
<p>Make sure you also read through the chirc project documentation, but
<em>don’t be intimidated by the length of the project specification</em>.
The main reason the specification is long is to carve out
exactly what part of the IRC specification you have to focus on. You
will actually be implementing a fairly small subset of the IRC
specification.</p>
<p>You should also take a moment to look through the provided starter
code. We suggest starting at the <code class="docutils literal notranslate"><span class="pre">main.c</span></code> file, and then gaining
some familiarity with the data structures specified in <code class="docutils literal notranslate"><span class="pre">chirc.h</span></code>.
We suggest focusing on the server context (<code class="docutils literal notranslate"><span class="pre">chirc_ctx_t</span></code>), the
connections (<code class="docutils literal notranslate"><span class="pre">chirc_connection_t</span></code>), the users (<code class="docutils literal notranslate"><span class="pre">chirc_user_t</span></code>) and the messages
(<code class="docutils literal notranslate"><span class="pre">chirc_message_t</span></code>) since those will be the most relevant at the
start of the project. You should also look at the functions provided
for those data structures (in <code class="docutils literal notranslate"><span class="pre">ctx.h</span></code>, <code class="docutils literal notranslate"><span class="pre">connection.h</span></code>, <code class="docutils literal notranslate"><span class="pre">user.h</span></code>, and <code class="docutils literal notranslate"><span class="pre">message.h</span></code>).</p>
<p>Next, the chirc server uses the following libraries:</p>
<ul class="simple">
<li><p>The <a class="reference external" href="https://troydhanson.github.io/uthash/">uthash</a> library
for hash tables. The chirc code is written to abstract away most uses of that library
(e.g., to add a new connection to the server context, you would use
the <code class="docutils literal notranslate"><span class="pre">chirc_ctx_add_connection</span></code> function instead of manipulating
the hash table yourself).</p></li>
<li><p>The <a class="reference external" href="https://github.com/antirez/sds">SDS</a>  library to manipulate strings.
SDS strings can be manipulated just like C strings (i.e., C string functions will
work with SDS strings), but the SDS library provides functions
that makes certain tasks easier. That said, you should not need
to do much string manipulation, since most of that is handled
by the provided code.</p></li>
</ul>
</section>
<section id="project-1-warm-up">
<h2>Project 1 Warm-up<a class="headerlink" href="#project-1-warm-up" title="Link to this heading">¶</a></h2>
<p>For the warm-up exercise, we suggest you do the following:</p>
<ul class="simple">
<li><p>Update <code class="docutils literal notranslate"><span class="pre">chirc_run</span></code> in <code class="docutils literal notranslate"><span class="pre">main.c</span></code> to create a passive socket and listen for new connections.</p></li>
<li><p>When a connection is accepted, initialize a <code class="docutils literal notranslate"><span class="pre">chirc_connection_t</span></code> struct. This includes creating
a <code class="docutils literal notranslate"><span class="pre">chirc_user_t</span></code> struct to place in the <code class="docutils literal notranslate"><span class="pre">peer.user</span></code> field of the <code class="docutils literal notranslate"><span class="pre">chirc_connection_t</span></code> struct.</p></li>
<li><p>When a message arrives through the connection, use the functions in <code class="docutils literal notranslate"><span class="pre">message.h</span></code> to parse the message.</p></li>
<li><p>Once a <code class="docutils literal notranslate"><span class="pre">NICK</span></code> and <code class="docutils literal notranslate"><span class="pre">USER</span></code> message have arrived, send a <code class="docutils literal notranslate"><span class="pre">001</span></code> reply (once again using functions in <code class="docutils literal notranslate"><span class="pre">message.h</span></code> to create the reply).</p></li>
</ul>
<p>While you can implement all this inside <code class="docutils literal notranslate"><span class="pre">chirc_run</span></code>, it will also pay off to do the following:</p>
<ul class="simple">
<li><p>Implement the <code class="docutils literal notranslate"><span class="pre">chirc_connection_send_message</span></code> function in <code class="docutils literal notranslate"><span class="pre">connection.c</span></code>. This function
will provide an abstraction over “sending a message through a connection”.</p></li>
<li><p>Start looking at the <code class="docutils literal notranslate"><span class="pre">handlers.c</span></code> module. Once you have a basic implementation
in <code class="docutils literal notranslate"><span class="pre">chirc_run</span></code>, you should look into implementing a <code class="docutils literal notranslate"><span class="pre">NICK</span></code> and <code class="docutils literal notranslate"><span class="pre">USER</span></code> handler
in the <code class="docutils literal notranslate"><span class="pre">handlers.c</span></code> module.</p></li>
</ul>
</section>
<section id="resolving-irc-ambiguities">
<h2>Resolving IRC Ambiguities<a class="headerlink" href="#resolving-irc-ambiguities" title="Link to this heading">¶</a></h2>
<p>The IRC protocol is, in some cases, not as well-specified and clear as one would hope (this is,
unfortunately, a common attribute of many network specifications). If you’re unclear about how your server is meant to behave in some cases (specially the more obscure corner cases of IRC, or the points where the IRC specification is ambiguous), you should take the following steps:</p>
<ol class="arabic">
<li><p>Check whether it makes any of our tests fail. If it doesn’t, your interpretation of the IRC protocol is probably fine. This includes the lack of features: if you’re not implementing some feature/command/reply/corner case/etc. and it isn’t covered by our tests, then you probably don’t need to implement it. The only exception is cases that are explicitly specified in the chirc specification (there are a few that are not covered by our tests).</p></li>
<li><p>Take into account that there are literally hundreds of production IRC servers on the Internet that you can log into to test how they’ve interpreted the IRC specification. We suggest using <a class="reference external" href="https://libera.chat/">Libera.Chat</a> servers, which you can log into simply by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">telnet</span> <span class="n">irc</span><span class="o">.</span><span class="n">libera</span><span class="o">.</span><span class="n">chat</span> <span class="mi">6667</span>
</pre></div>
</div>
<p>In general, if you replicate the behaviour of a production IRC server, that’s good enough for us.</p>
</li>
<li><p>You can also test the command on our reference implementation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">telnet</span> <span class="n">frost</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">uchicago</span><span class="o">.</span><span class="n">edu</span> <span class="mi">6666</span>
</pre></div>
</div>
</li>
</ol>
<p>Note: if that server is unresponsive, we are also running reference implementations on ports 6661-6665.</p>
<p>Like a production IRC server, if you replicate the behaviour of our reference implementation, that’s good enough for us.</p>
</section>
<section id="common-issues-in-chirc-assignment-1">
<h2>Common Issues in chirc Assignment 1<a class="headerlink" href="#common-issues-in-chirc-assignment-1" title="Link to this heading">¶</a></h2>
<section id="error-handling-in-sockets">
<h3>Error handling in sockets<a class="headerlink" href="#error-handling-in-sockets" title="Link to this heading">¶</a></h3>
<p>Don’t forget to check the return value of the socket functions: your code is likely to behave strangely if you don’t react appropriately to certain error conditions (e.g., a return code of 0 from recv means that the client has disconnected; in chirc Assignment 4 you will need to “log out” the user from the IRC server when that happens).</p>
</section>
<section id="general-socket-confusion">
<h3>General socket confusion<a class="headerlink" href="#general-socket-confusion" title="Link to this heading">¶</a></h3>
<p>If you’re confused about how to use sockets, we recommend you read <a class="reference external" href="http://beej.us/guide/bgnet/">Beej’s Guide to Network Programming</a> for a more thorough review of sockets.</p>
</section>
</section>
<section id="common-issues-in-chirc-assignment-4">
<h2>Common Issues in chirc Assignment 4<a class="headerlink" href="#common-issues-in-chirc-assignment-4" title="Link to this heading">¶</a></h2>
<section id="inadequate-locking">
<h3>Inadequate locking<a class="headerlink" href="#inadequate-locking" title="Link to this heading">¶</a></h3>
<p>In chirc Assigmnent 4, you now have multiple clients connecting to your server, with one thread
per client. So remember: shared data structures have to be protected by locks, and this includes
any socket that multiple threads could write to. POSIX requires system calls to be thread-safe (i.e., the OS itself should guarantee that send() is done atomically). However, even though a call to send() can be thread-safe, you have to account for the fact that send() might not send all your data in one go. So, you still need to gain exclusive access to the socket until a full message has been sent; otherwise, you could see partial messages interleaved by multiple threads.</p>
<p>Beej’s Guide actually provides a handy <a class="reference external" href="https://beej.us/guide/bgnet/html/#sendall">sendall</a> function that you can use to ensure that send() sends all the data you want it to send. You would still need to update this <cite>sendall</cite> function to lock/unlock the socket’s lock.</p>
</section>
</section>
<section id="common-c-issues">
<h2>Common C Issues<a class="headerlink" href="#common-c-issues" title="Link to this heading">¶</a></h2>
<section id="bad-memory-management">
<h3>Bad memory management<a class="headerlink" href="#bad-memory-management" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Make sure that any block of code you malloc() is also free()’d.</p></li>
<li><p>Don’t return pointers to stack-allocated variables (i.e., local function variables). Remember:
stack-allocated variables become invalid after the function returns. Stack-allocated data should
only be used during the lifetime of a function. So, for example, calling function B from function
A, and giving B a pointer to a local variable of A is fine. Returning a pointer to a local
variable of A, on the other hand, is not.</p></li>
<li><p>If you initialize pointers to NULL (e.g., to indicate the absence of something), make sure you
always check whether that pointer is NULL before using it.</p></li>
<li><p>C has a wonderful function called <code class="docutils literal notranslate"><span class="pre">strdup</span></code> that will create a copy of a string and malloc
the exact amount of memory needed for it. You should use this function any time you want to make a
copy of a string. Take into account that using assignment (=) will create a shallow copy, meaning
that if the original string is modified (or free()’d) it will affect the copy too.</p></li>
</ul>
</section>
<section id="arbitrary-sizes">
<h3>Arbitrary sizes<a class="headerlink" href="#arbitrary-sizes" title="Link to this heading">¶</a></h3>
<p>Whenever the amount of needed memory is unknown, a common approach is to allocate an arbitrary amount of memory. This is fine, but you should be a little more methodical than just allocating several kilobytes of memory as an arbitrarily large amount. Whenever you allocate an arbitrary amount of memory, you should specify what your assumptions are (e.g., are you assuming that each line of the MOTD file won’t have more than X characters?) and, ideally, a note on what conditions would make your program crash given that arbitrary limit.</p>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011-2024, The University of Chicago.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.2.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>